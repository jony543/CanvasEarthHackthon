<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=9">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<title>Sample 1, Part 1</title>

	<link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
    <style>
        #red, #green, #blue {
            float: left;
            clear: left;
            width: 300px;
            margin: 15px;
        }
        #swatch {
            width: 120px;
            height: 100px;
            margin-top: 18px;
            margin-left: 350px;
            background-image: none;
        }
        #red .ui-slider-range { background: #ef2929; }
        #red .ui-slider-handle { border-color: #ef2929; }
        #green .ui-slider-range { background: #8ae234; }
        #green .ui-slider-handle { border-color: #8ae234; }
        #blue .ui-slider-range { background: #729fcf; }
        #blue .ui-slider-handle { border-color: #729fcf; }
    </style>

	<script src="../sdk/scripts/jquery.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
    <script src="jquery.ui.touch-punch.js"></script>

	<script type="text/javascript" src="../sdk/scripts/js.ext.js"></script>
	<script type="text/javascript" src="../sdk/scripts/js.ext.dom.js"></script>

	<script type="text/javascript" src="../sdk/engine/Module.js"></script>
	<script async type="text/javascript" src="../sdk/engine/WacomInkEngine.js"></script>

	<script type="text/javascript" src="binaryajax.js"></script>
	<script type="text/javascript" src="exif.js"></script>
	<script type="text/javascript" src="tryout.js"></script>

	<style type="text/css">
		body {position: relative; overflow: hidden; margin: 0; padding: 0; background-color: #252525; color: white;}
		canvas {border: 0px none;}
		h2, p {margin-left: 20px;}
	</style>
</head>
<body>
	<canvas id="canvas" oncontextmenu="event.preventDefault();"></canvas>

	<h2>Pick A Canvas</h2>
	<p>Ink Engine Setup (Configure layer, brush, path builder)</p>
	<input type="file" id="files" accept="image/*"/>
	<div style="width: 20%" id="scale"></div>

	<div>
		<h3>Select Brush</h3>
		<div>
            <div id="red"></div>
            <div id="green"></div>
            <div id="blue"></div>

            <div id="swatch" class="ui-widget-content ui-corner-all"></div>
        </div>
	</div>

	<script type="text/javascript">
		// Check for the various File API support.
		if (window.File && window.FileReader && window.FileList && window.Blob) {
			// Great success! All the File APIs are supported.
		} else {
			alert('The File APIs are not fully supported in this browser.');
		}

		var imageLat;
		var imageLon;
		var imageScale = 0.2;
		var imageUrl;
        var imageHeight;
        var imageWidth;

		var canvas = document.getElementById("canvas");

		// detect a change in a file input with an id of “the-file-input”
		$("#files").change(function() {
			//Get the photo from the input form
			var input = document.getElementById('files');
			var files = input.files;
			for(var i = 0; i < files.length; i++)
			{
				var file = files[0];
				var reader = new FileReader; // use HTML5 file reader to get the file

				reader.onloadend = function () {
					// get EXIF data
					var exif = EXIF.readFromBinaryFile(this.result); //new BinaryFile(this.result));

					if (exif) {
						var lat = exif.GPSLatitude;
						var lon = exif.GPSLongitude;

						if (lat && lon) {
							//Convert coordinates to WGS84 decimal
							var latRef = exif.GPSLatitudeRef || "N";
							var lonRef = exif.GPSLongitudeRef || "W";
							lat = (lat[0] + lat[1] / 60 + lat[2] / 3600) * (latRef == "N" ? 1 : -1);
							lon = (lon[0] + lon[1] / 60 + lon[2] / 3600) * (lonRef == "W" ? -1 : 1);

                            imageHeight = exif.PixelYDimension;
                            imageWidth = exif.PixelXDimension;

							var urlReader = new FileReader();
							urlReader.onload = function(event){
								imageUrl = event.target.result;
								WILL.initImageLayer(imageUrl, imageWidth, imageHeight);
							};
							urlReader.readAsDataURL(file);

						} else {
							alert('Could not extract image geo location');
						}

						console.log("lat: " + lat  + " " + latRef + "; lon: " + lon + " " + lonRef);
					} else{
						alert('Could not extract image geo location');
						console.log(exif);
					}
				};

				reader.readAsArrayBuffer(file);
			}
		});


        function hexFromRGB(r, g, b) {
            var hex = [
                r.toString( 16 ),
                g.toString( 16 ),
                b.toString( 16 )
            ];
            $.each( hex, function( nr, val ) {
                if ( val.length === 1 ) {
                    hex[ nr ] = "0" + val;
                }
            });
            return hex.join( "" ).toUpperCase();
        }
        function refreshSwatch() {
            var red = $( "#red" ).slider( "value" ),
                    green = $( "#green" ).slider( "value" ),
                    blue = $( "#blue" ).slider( "value" ),
                    hex = hexFromRGB( red, green, blue );
            $( "#swatch" ).css( "background-color", "#" + hex );
            WILL.color = Module.Color.from(red, green, blue);
            if (WILL.strokeRenderer) {
                WILL.strokeRenderer.configure({brush: WILL.brush, color: WILL.color});
            }
        }


        $( "#red, #green, #blue" ).slider({
            orientation: "horizontal",
            range: "min",
            max: 255,
            value: 127,
            slide: refreshSwatch,
            change: refreshSwatch
        });
        $( "#red" ).slider( "value", 255 );
        $( "#green" ).slider( "value", 140 );
        $( "#blue" ).slider( "value", 60 );

	</script>
</body>
</html>