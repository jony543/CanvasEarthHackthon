<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Drawing preliminary paths | WILL SDK Docs</title>
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<link rel="pingback" href="http://localhost/will_docs_instance1/xmlrpc.php">
	<!--[if lt IE 9]>
	<script src="http://localhost/will_docs_instance1/wp-content/themes/will-doc/js/html5.js"></script>
	<![endif]-->

	<link rel="stylesheet" href="../../wp-content/themes/will-doc/css/style.css">
	<link rel="stylesheet" href="../../wp-content/themes/will-doc/css/accordionmenu.css">

	<script src="../../wp-content/themes/will-doc/js/jquery.min.js"></script>
	<script src="../../wp-content/themes/will-doc/js/sidebar.js"></script>

	<link rel="stylesheet" href="../../wp-content/themes/will-doc/css/highlight.css">
	<script src="../../wp-content/themes/will-doc/js/highlight.pack.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
	<header>
		<div class="title">
			<div>WILL &trade;</div>
			<div>sdk documentation</div>
		</div>
		<!--
		<div id="searchbox">
			<input class="typeahead" type="text" placeholder="{{ search_text }}">
		</div>
-->
	</header>

	<div id="sitewrapper">
<div id="sidebar">
	<nav class="accordion">

				<h1 class="do-not-cause-collapse" title="General Concepts">

			General Concepts
			</h1>

							<div class="active-menu never-close">
					<h2 class="not-collapsible" title="Architectural Overview">

								<a href="../../general-concepts/architecture/index.html"
											>Architectural Overview</a>
					
			</h2>

						<h2 class="not-collapsible" title="Generating ink content">

								<a href="../../general-concepts/path-building/index.html"
											>Generating ink content</a>
					
			</h2>

						<h2 class="not-collapsible" title="Rendering ink content">

								<a href="../../general-concepts/rasterizer/index.html"
											>Rendering ink content</a>
					
			</h2>

						<h2 class="not-collapsible" title="Encoding and decoding ink content">

								<a href="../../general-concepts/serialization/index.html"
											>Encoding and decoding ink content</a>
					
			</h2>

						<h2 class="not-collapsible" title="Exchanging ink content">

								<a href="../../general-concepts/file-format/index.html"
											>Exchanging ink content</a>
					
			</h2>

							</div>
							<h1 title="Web SDK">

			Web SDK
			</h1>

							<div>
					<h2 title="Getting started">

								<a href="../getting-started/index.html"
											>Getting started</a>
					
			</h2>

						<h2 title="Release Notes">

								<a href="../release-notes/index.html"
											>Release Notes</a>
					
			</h2>

						<h2 title="Tutorials">

								<a href="../tutorials-overview/index.html"
											>Tutorials</a>
					
			</h2>

							<div>
					<h3 title="Tutorial 1: Drawing with pointing devices">

								<a href="../tutorials-tutorial1/index.html"
											>Tutorial 1: Drawing with pointing devices</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Setting up the ink engine">

								<a href="../tutorials-tutorial1-part1/index.html"
											>Part 1: Setting up the ink engine</a>
					
			</h4>

						<h4 title="Part 2: Building paths from pointer input">

								<a href="../tutorials-tutorial1-part2/index.html"
											>Part 2: Building paths from pointer input</a>
					
			</h4>

						<h4 title="Part 3: Smoothing paths">

								<a href="../tutorials-tutorial1-part3/index.html"
											>Part 3: Smoothing paths</a>
					
			</h4>

						<h4 title="Part 4: Drawing preliminary paths">

								<a href="index.html"
						 class="selected"					>Part 4: Drawing preliminary paths</a>
					
			</h4>

						<h4 title="Part 5: Drawing semi-transparent strokes">

								<a href="../tutorials-tutorial1-part5/index.html"
											>Part 5: Drawing semi-transparent strokes</a>
					
			</h4>

						<h4 title="Part 6: Using a particle brush">

								<a href="../tutorials-tutorial1-part6/index.html"
											>Part 6: Using a particle brush</a>
					
			</h4>

						<h4 title="Part 7: Generating a Bezier path">

								<a href="../tutorials-tutorial1-part7/index.html"
											>Part 7: Generating a Bezier path</a>
					
			</h4>

							</div>
							<h3 title="Tutorial 2: Encoding and decoding strokes">

								<a href="../tutorials-tutorial2/index.html"
											>Tutorial 2: Encoding and decoding strokes</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Creating a stroke model">

								<a href="../tutorials-tutorial2-part1/index.html"
											>Part 1: Creating a stroke model</a>
					
			</h4>

						<h4 title="Part 2: Serializing and deserializing strokes">

								<a href="../tutorials-tutorial2-part2/index.html"
											>Part 2: Serializing and deserializing strokes</a>
					
			</h4>

							</div>
							<h3 title="Tutorial 3: Erasing strokes">

								<a href="../tutorials-tutorial3/index.html"
											>Tutorial 3: Erasing strokes</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Creating an eraser">

								<a href="../tutorials-tutorial3-part1/index.html"
											>Part 1: Creating an eraser</a>
					
			</h4>

						<h4 title="Part 2: Erasing parts of strokes">

								<a href="../tutorials-tutorial3-part2/index.html"
											>Part 2: Erasing parts of strokes</a>
					
			</h4>

							</div>
							<h3 title="Tutorial 4: Selecting strokes">

								<a href="../tutorials-tutorial4/index.html"
											>Tutorial 4: Selecting strokes</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Selecting strokes">

								<a href="../tutorials-tutorial4-part1/index.html"
											>Part 1: Selecting strokes</a>
					
			</h4>

						<h4 title="Part 2: Selecting parts of strokes">

								<a href="../tutorials-tutorial4-part2/index.html"
											>Part 2: Selecting parts of strokes</a>
					
			</h4>

							</div>
							<h3 title="Tutorial 5: Working with rasters">

								<a href="../tutorials-tutorial5/index.html"
											>Tutorial 5: Working with rasters</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Displaying raster images">

								<a href="../tutorials-tutorial5-part1/index.html"
											>Part 1: Displaying raster images</a>
					
			</h4>

						<h4 title="Part 2: Creating image masks">

								<a href="../tutorials-tutorial5-part2/index.html"
											>Part 2: Creating image masks</a>
					
			</h4>

							</div>
							<h3 title="Tutorial 6: Collaborating in real time">

								<a href="../tutorials-tutorial6/index.html"
											>Tutorial 6: Collaborating in real time</a>
					
			</h3>

							<div>
					<h4 title="Part 1: Composing strokes">

								<a href="../tutorials-tutorial6-part1/index.html"
											>Part 1: Composing strokes</a>
					
			</h4>

						<h4 title="Part 2: Erasing strokes">

								<a href="../tutorials-tutorial6-part2/index.html"
											>Part 2: Erasing strokes</a>
					
			</h4>

						<h4 title="Part 3: Erasing parts of strokes">

								<a href="../tutorials-tutorial6-part3/index.html"
											>Part 3: Erasing parts of strokes</a>
					
			</h4>

						<h4 title="Part 4: Selecting strokes">

								<a href="../tutorials-tutorial6-part4/index.html"
											>Part 4: Selecting strokes</a>
					
			</h4>

						<h4 title="Part 5: Selecting parts of strokes">

								<a href="../tutorials-tutorial6-part5/index.html"
											>Part 5: Selecting parts of strokes</a>
					
			</h4>

						<h4 title="Part 6: Composing strokes with latency">

								<a href="../tutorials-tutorial6-part6/index.html"
											>Part 6: Composing strokes with latency</a>
					
			</h4>

							</div>
								</div>
							<h2 title="API Reference">

			API Reference
			</h2>

							<div>
					<h3 title="Classes">

			Classes
			</h3>

							<div>
					<h4 title="BezierPath">

								<a href="../../web-api/Module.BezierPath/index.html"
											>BezierPath</a>
					
			</h4>

						<h4 title="BrushDecoder">

								<a href="../../web-api/Module.BrushDecoder/index.html"
											>BrushDecoder</a>
					
			</h4>

						<h4 title="BrushEncoder">

								<a href="../../web-api/Module.BrushEncoder/index.html"
											>BrushEncoder</a>
					
			</h4>

						<h4 title="DirectBrush">

								<a href="../../web-api/Module.DirectBrush/index.html"
											>DirectBrush</a>
					
			</h4>

						<h4 title="FlatPath">

								<a href="../../web-api/Module.FlatPath/index.html"
											>FlatPath</a>
					
			</h4>

						<h4 title="GenericLayer">

								<a href="../../web-api/Module.GenericLayer/index.html"
											>GenericLayer</a>
					
			</h4>

						<h4 title="GenericPath">

								<a href="../../web-api/Module.GenericPath/index.html"
											>GenericPath</a>
					
			</h4>

						<h4 title="InkCanvas">

								<a href="../../web-api/Module.InkCanvas/index.html"
											>InkCanvas</a>
					
			</h4>

						<h4 title="InkDecoder">

								<a href="../../web-api/Module.InkDecoder/index.html"
											>InkDecoder</a>
					
			</h4>

						<h4 title="InkEncoder">

								<a href="../../web-api/Module.InkEncoder/index.html"
											>InkEncoder</a>
					
			</h4>

						<h4 title="Intersector">

								<a href="../../web-api/Module.Intersector/index.html"
											>Intersector</a>
					
			</h4>

						<h4 title="MultiChannelSmoothener">

								<a href="../../web-api/Module.MultiChannelSmoothener/index.html"
											>MultiChannelSmoothener</a>
					
			</h4>

						<h4 title="OffscreenLayer">

								<a href="../../web-api/Module.OffscreenLayer/index.html"
											>OffscreenLayer</a>
					
			</h4>

						<h4 title="ParticleBrush">

								<a href="../../web-api/Module.ParticleBrush/index.html"
											>ParticleBrush</a>
					
			</h4>

						<h4 title="PathBuilder">

								<a href="../../web-api/Module.PathBuilder/index.html"
											>PathBuilder</a>
					
			</h4>

						<h4 title="PathContext">

								<a href="../../web-api/Module.PathContext/index.html"
											>PathContext</a>
					
			</h4>

						<h4 title="PathOperationDecoder">

								<a href="../../web-api/Module.PathOperationDecoder/index.html"
											>PathOperationDecoder</a>
					
			</h4>

						<h4 title="PathOperationEncoder">

								<a href="../../web-api/Module.PathOperationEncoder/index.html"
											>PathOperationEncoder</a>
					
			</h4>

						<h4 title="PressurePathBuilder">

								<a href="../../web-api/Module.PressurePathBuilder/index.html"
											>PressurePathBuilder</a>
					
			</h4>

						<h4 title="SolidColorBrush">

								<a href="../../web-api/Module.SolidColorBrush/index.html"
											>SolidColorBrush</a>
					
			</h4>

						<h4 title="SpeedPathBuilder">

								<a href="../../web-api/Module.SpeedPathBuilder/index.html"
											>SpeedPathBuilder</a>
					
			</h4>

						<h4 title="Stroke">

								<a href="../../web-api/Module.Stroke/index.html"
											>Stroke</a>
					
			</h4>

						<h4 title="StrokeBrush">

								<a href="../../web-api/Module.StrokeBrush/index.html"
											>StrokeBrush</a>
					
			</h4>

						<h4 title="StrokeDrawContext">

								<a href="../../web-api/Module.StrokeDrawContext/index.html"
											>StrokeDrawContext</a>
					
			</h4>

						<h4 title="StrokeRenderer">

								<a href="../../web-api/Module.StrokeRenderer/index.html"
											>StrokeRenderer</a>
					
			</h4>

							</div>
							<h3 title="Interfaces">

			Interfaces
			</h3>

							<div>
					<h4 title="PathOperationDecoderCallbacksHandlerInterface">

								<a href="../../web-api/Module.PathOperationDecoderCallbacksHandlerInterface/index.html"
											>PathOperationDecoderCallbacksHandlerInterface</a>
					
			</h4>

							</div>
							<h3 title="Namespaces">

			Namespaces
			</h3>

							<div>
					<h4 title="Module">

								<a href="../../web-api/Module/index.html"
											>Module</a>
					
			</h4>

						<h4 title="Module.Color">

								<a href="../../web-api/Module.Color/index.html"
											>Module.Color</a>
					
			</h4>

						<h4 title="Module.GLTools">

								<a href="../../web-api/Module.GLTools/index.html"
											>Module.GLTools</a>
					
			</h4>

						<h4 title="Module.MatTools">

								<a href="../../web-api/Module.MatTools/index.html"
											>Module.MatTools</a>
					
			</h4>

						<h4 title="Module.RectTools">

								<a href="../../web-api/Module.RectTools/index.html"
											>Module.RectTools</a>
					
			</h4>

							</div>
							<h3 title="Global">

								<a href="../../web-api/global/index.html"
											>Global</a>
					
			</h3>

			
	</nav>
</div><div id="page_content" class='page-content tutorials web'>
	<div class="seealso"><h2>See Also</h2><p>For more information, see the following topic:</p><ul><li><a href="../../general-concepts/path-building/index.html">Generating ink content</a></li></ul></div>
<div id="post-48" class="page">
	<h1>Drawing with pointing devices</h1>
<h2>Part 4: Drawing preliminary paths</h2>
<p>There is a lag in stroke generation while the smoothing algorithm smooths the partial paths of a stroke.</p>
<p>In Part 4 of this tutorial, you will draw preliminary stroke curves (that is, curves from the last path point to the current location of the pointer) to
neutralize any lag in the stroke generation. Since the preliminary path is a prediction for the trajectory of the real path and can prove wrong,
especially if the stroke makes a sharp turn, you will display the preliminary path temporarily and discard it later.</p>
<h3>Step 1. Add a second layer to store completed strokes</h3>
<p>Extend the path building process to add a second layer called <code>strokesLayer</code>, as follows:</p>
<pre><code class="javascript">initInkEngine: function(width, height) {
    this.canvas = new Module.InkCanvas(document.getElementById("canvas"), width, height);
    this.strokesLayer = this.canvas.createLayer();

    this.clear();

    this.brush = new Module.DirectBrush();

    this.pathBuilder = new Module.SpeedPathBuilder();
    this.pathBuilder.setNormalizationConfig(182, 3547);
    this.pathBuilder.setPropertyConfig(Module.PropertyName.Width, 2.05, 34.53, 0.72, NaN, Module.PropertyFunction.Power, 1.19, false);

    this.smoothener = new Module.MultiChannelSmoothener(this.pathBuilder.stride);

    this.strokeRenderer = new Module.StrokeRenderer(this.canvas, this.strokesLayer);
    this.strokeRenderer.configure({brush: this.brush, color: this.color});
},</code></pre>
<h3>Step 2: Blend the existing strokes to the canvas</h3>
<p>Draw the current part of the stroke in the <code>strokesLayer</code> object, then blend it to the <code>canvas</code> object so it can be rendered on the screen.</p>
<h3>Step 3. Draw the preliminary path directly on the canvas</h3>
<p>Draw the preliminary path directly on the canvas. Use the <code>pathBuilder.createPreliminaryPath</code> method to create a preliminary path,
then smooth it with the <code>smoothener.smooth(preliminaryPathPart, true)</code> method.</p>
<p>To indicate that the smoothing should finish, call the <code>smooth</code> method with its <code>finish</code> parameter set to <em>true</em>.</p>
<p>Pass the smoothed part to the <code>finishPreliminaryPath</code> method, which returns the completed preliminary path.</p>
<pre><code class="javascript">buildPath: function(pos) {
    if (this.inputPhase == Module.InputPhase.Begin)
        this.smoothener.reset();

    var pathPart = this.pathBuilder.addPoint(this.inputPhase, pos, Date.now()/1000);
    var smoothedPathPart = this.smoothener.smooth(pathPart, this.inputPhase == Module.InputPhase.End);
    var pathContext = this.pathBuilder.addPathPart(smoothedPathPart);

    this.pathPart = pathContext.getPathPart();

    if (this.inputPhase == Module.InputPhase.Move) {
        var preliminaryPathPart = this.pathBuilder.createPreliminaryPath();
        var preliminarySmoothedPathPart = this.smoothener.smooth(preliminaryPathPart, true);

        this.preliminaryPathPart = this.pathBuilder.finishPreliminaryPath(preliminarySmoothedPathPart);
    }
},</code></pre>
<p><strong>Note:</strong> As mentioned in <a href="../tutorials-tutorial1-part1/index.html">Part 1</a>, the second parameter of the <code>strokeRenderer</code> class specifies different behaviors.
In this example, the second parameter is set to <em>strokesLayer</em>, which means that completed strokes are stored in the <em>strokesLayer</em> instance.
However, preliminary curves are drawn on the canvas (since the preliminary curves are temporary data and you do not want to store them permanently).
The <code>strokeRenderer.blendUpdatedArea</code> method copies the contents of <em>strokesLayer</em> into the canvas for the purpose of generating preliminary paths.
Drawing the preliminary path directly on the canvas is convenient for this example, but other strategies are also possible.</p>
<h3>Step 4. Add a round cap to the start and end of strokes</h3>
<p>In the previous example, strokes had cut-off start and end parts. To resolve this, you will round the ends of the stroke.</p>
<p>Add a round beginning cap to the first drawing segment (you can do this for either the preliminary or the actual segment),
then add a round ending cap for each preliminary curve and for the ending of the actual stroke. The <code>strokeRenderer</code> class contains a method to add caps to strokes.</p>
<p>For example, to add a round beginning cap to the first drawing segment and to each preliminary curve, you can add the following code to the <code>beginStroke</code> and <code>drawPoint</code> functions:</p>
<pre><code class="javascript">this.strokeRenderer.draw(this.pathPart, false)</code></pre>
<p>To add a round ending cap to the end of the stroke, you can add the following code to the <code>endStroke</code> function:</p>
<pre><code class="javascript">this.strokeRenderer.draw(this.pathPart, true)</code></pre>
<h3>Step 5. Change the color of the preliminary curve</h3>
<p>Change the color of the preliminary curve to emphasize it.</p>
<p><strong>Note:</strong> In a real application, the color of the preliminary curve will probably be the same as the color of the stroke. For this tutorial,
choose a noticeably different color to highlight the preliminary curve.</p>
<h3>Step 5. Recompose view for completed stroke bounds</h3>
<pre><code class="javascript">    this.canvas.clear(this.strokeRenderer.strokeBounds, this.backgroundColor);
    this.canvas.blend(this.strokesLayer, {rect: this.strokeRenderer.strokeBounds});</code></pre>
<p><strong>Note:</strong> Note that recomposition starts from the beginning, the updated area is cleared, than blending should happens.</p>
<p>The completed code for this part of the tutorial is as follows:</p>
<pre><code class="javascript">var WILL = {
    ...

    init: function(width, height) {...},

    initInkEngine: function(width, height) {
        ...

        this.strokesLayer = this.canvas.createLayer();

        this.strokeRenderer = new Module.StrokeRenderer(this.canvas, this.strokesLayer);
        this.strokeRenderer.configure({brush: this.brush, color: this.color});
    },

    initEvents: function() {...},
    beginStroke: function(e) {...},
    moveStroke: function(e) {...},
    endStroke: function(e) {...},

    buildPath: function(pos) {
        ...

        if (this.inputPhase == Module.InputPhase.Move) {
            var preliminaryPathPart = this.pathBuilder.createPreliminaryPath();
            var preliminarySmoothedPathPart = this.smoothener.smooth(preliminaryPathPart, true);

            this.preliminaryPathPart = this.pathBuilder.finishPreliminaryPath(preliminarySmoothedPathPart);
        }
    },

    drawPath: function() {
        if (this.inputPhase == Module.InputPhase.Begin) {
            this.strokeRenderer.draw(this.pathPart, false);
            this.strokeRenderer.blendUpdatedArea();
        }
        else if (this.inputPhase == Module.InputPhase.Move) {
            this.canvas.clear(this.strokeRenderer.updatedArea, this.backgroundColor);
            this.canvas.blend(this.strokesLayer, {rect: this.strokeRenderer.updatedArea});

            this.strokeRenderer.draw(this.pathPart, false);
            this.strokeRenderer.blendUpdatedArea();

            this.strokeRenderer.color = Module.Color.RED;
            this.strokeRenderer.drawPreliminary(this.preliminaryPathPart);
            this.strokeRenderer.color = this.color;
        }
        else if (this.inputPhase == Module.InputPhase.End) {
            this.strokeRenderer.draw(this.pathPart, true);

            this.strokeRenderer.blendStroke(this.strokesLayer);

            this.canvas.clear(this.strokeRenderer.strokeBounds, this.backgroundColor);
            this.canvas.blend(this.strokesLayer, {rect: this.strokeRenderer.strokeBounds});
        }
    },

    clear: function() {
        this.strokesLayer.clear(this.backgroundColor);
        this.canvas.clear(this.backgroundColor);
    }
};

Module.addPostScript(function() {...});</code></pre>
<p><strong>Note:</strong> For the sake of clarity, method implementations from earlier in this tutorial are replaced with <code>...</code> in the example code above.</p>
<h2>View sample</h2>
<ul>
<li><a href="http://localhost/will_docs_instance1/web/tutorials/Sample1/part4.js">View complete source code</a></li>
<li><a href="../tutorials/Sample1/Part4.html">View sample</a></li>
</ul>
<p>In <a href="../tutorials-tutorial1-part5/index.html">Part 5</a> of this tutorial, you will add variable transparency to your strokes.</p>
<h2>Next steps</h2>
<p>At this point, you can continue with this tutorial, or you can proceed to <a href="../tutorials-tutorial2/index.html">Tutorial 2: Encoding and decoding strokes</a>.</p>
</div> <!-- page -->
			<nav class="prev-next-page">
									<a href="../tutorials-tutorial1-part3/index.html" class="prev-page">&laquo; Smoothing paths</a>
										<a href="../tutorials-tutorial1-part5/index.html" class="next-page">Drawing semi-transparent strokes &raquo;</a>
								</nav>
			</div> <!-- page_content -->

	</div><!-- #sitewrapper -->

	<footer>
		<img src="../../wp-content/themes/will-doc/images/img_logo_wacom.png" alt="" />
<!--
		<span>&nbsp;</span>
		<a href="/contact.html">Contact</a>
		<a href="/support.html">Support</a>
-->
	</footer>
</body>
</html>